 <span id="mulu"></span>

# 掉落              

[1. 入门](#1)  
 
[2. 简单的掉落](#2)  
 
[3. Inventory Engine 掉落](#3) 
 
[4. 定义你的掉落表](#4) 

[5. 在游戏中添加掉落](#5) 

[6. 进一步完善掉落系统](#6) 

<p id="1"></p>              

## 1. 入门
 
大多数游戏都会以某种形式为玩家的特定行动提供随机奖励。在topdown的游戏中，敌人在死亡时会掉落战利品。《Hotline Miami》的敌人会掉落他们的武器，《暗黑破坏神》的怪物会掉落随机的金子和物品，板条箱可能会包含随机的奖励等等。TopDown引擎可以让你轻松地执行类似的随机战利品系统。它是通用的，这意味着你可以使用它去执行各种你需要控制随机性的系统:战利品箱，关卡生成，NPC属性创造，类似《无主之地》的武器生成器等等。就像Daniel Cook在2014年的博客中所描述的那样，基于战利品表的设计模式，这一系统虽然简单但却非常强大，并且能够为你的游戏创造更多可能性
 
[返回目录](#mulu)

<p id="2"></p>              

## 2. 入门
 
该引擎包含PickableItem类，它将处理收集、效果、状态变化等通常在可收集的拾取器上发现的所有逻辑。它应该被扩展(或与其他类一起使用)。你可以在Stimpack类中看到一个例子，这是一个非常简单的类，它会在一个拥有生命值的角色与之碰撞时为其添加生命值。
 
[返回目录](#mulu)

<p id="3"></p>              

## 3. Inventory Engine 掉落
 
为了让你的角色收集库存引擎道具，你有一些选择，通常是ItemPicker和PickableItem组合，或者是简单的InventoryPickableItem:

    ItemPicker: InventoryEngine的一部分，这个不可知性类负责通过Pick方法将库存物品添加到库存中

    PickableItem: TopDown引擎的一部分，处理碰撞、触发器、反馈和世界中可收集对象的状态变化，可以用于ItemPicker之外的完全控制

    InventoryPickableItem: TopDown引擎的一部分，扩展了InventoryEngine的ItemPicker，让你在挑选时添加视觉效果。它是一个非常简单的类，可以作为上面两个类的最小替代。

你会在许多演示场景中发现这些动作，例如在Loft3D演示场景中
 
[返回目录](#mulu)

<p id="4"></p>              

## 4. 定义你的掉落表
 
 ![示例图片](/images/loot-1.png)

 Loft3DLootTable脚本对象

 在掉落战利品之前，你需要做的第一件事便是定义战利品的定义。战利品定义是一个可脚本化的对象(数据文件)，它将包含关于战利品表中哪些对象以及获得每个对象的几率的信息。要创建一个，在项目的任何文件夹，右键单击>，创建> More Mountains > Loot Definition。接下来，定义你的战利品表应该包含多少个对象，对于每个对象，拖拽你希望在掉落战利品时产生的对象的预制件，并指定它们各自的权重。权重是相对的，它们不需要加起来等于任何特定的数字。如果你有3个物体A、B和C，并且希望C比其他物体掉落的次数多10倍，你可以不加区分地设置如下重量:A:1、B:1、C:10，或者你可以设置A:2、B:2、C:20

[返回目录](#mulu)

<p id="5"></p>              

## 5. 在游戏中添加掉落
 
为了让这些物品掉落在游戏中，你可以使用战利品组件。它被设计成与生命值组件一起工作，让你在死亡或伤害时触发掉落的战利品。或者，它也可以独立使用，你所需要做的就是调用它的公共方法SpawnLoot，它会掉落战利品。

例如，你可以选择一个敌人，并添加战利品组件。在它的检查器中，你可以自定义它的行为:
 
    Loot mode:独特可以让你生成一个单一的对象，战利品表可以让你定义一个本地的战利品表(只针对这个特定的敌人/对象)，战利品表脚本对象可以让你绑定一个战利品定义，就像上面描述的那样。

    Conditions:将让你决定你是否希望战利品刷出发生在死亡或伤害(或两者都发生)。这需要运行状况组件。

    Spawn部分将允许您定义延迟(以秒为单位)，一个可选的随机数量的对象生成，以及高级生成属性。

    Spawn Properties:在这里你可以定义衍生对象将被实例化的区域形状。您需要特别注意NormalToSpawnPlane，它定义了对象将在其中实例化的平面。通常对于3D你会使用0,1,0而对于2D你会使用0,0,1。刷出属性还可以让你指定偏移量，半径，随机旋转和缩放。

    Collisions :让战利品系统在刷出物体前检查碰撞的选项(例如，避免武器拾取器出现在墙的中间)。

    Feedbacks :与引擎中的大多数系统一样，你可以在其中插入mmfeedback，它将在战利品掉落时在刷出位置发挥作用。

    Debug :这个部分允许你在运行时生成大量的对象，以检查它们的位置以及结果是否与你定义战利品表时所想的相符。还有一个选项可以让你画出显示拖放区域的小玩意

[返回目录](#mulu)

<p id="6"></p>              

## 6. 进一步完善掉落系统
 
这个系统的核心是MMLootTable类。这是一个通用类，定义了一列要“战利品”或挑选的对象，每个对象都有权重。它有两个简单的方法:ComputeWeights，它通常只在初始化时调用一次，以及GetLoot，它将返回一个从表中随机选取的对象。如果您想要选择多个对象，只需重复操作。在上面的例子中，我们对游戏对象进行了这种操作，但这个类是通用的，你可以对任何其他对象进行这种操作。该引擎自带MMLootTableFloat(用于浮点数)和MMLootTableString(用于字符串)的现成实现，你当然可以添加更多来满足你的特定需求。

[返回目录](#mulu)